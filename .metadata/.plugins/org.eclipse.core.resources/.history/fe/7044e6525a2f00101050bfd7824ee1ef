package com.revati.airline;

import java.awt.*;
import java.awt.event.*;
import java.sql.*;
import javax.swing.*;

public class AddCustomer {

    public static JInternalFrame getAddCustomerFrame() {
        JInternalFrame internalFrame = new JInternalFrame("Add Customer", true, true, true, true);
        internalFrame.setSize(700, 400);
        internalFrame.setLayout(null);
        internalFrame.getContentPane().setBackground(Color.BLUE);

        JLabel title = new JLabel("Welcome to the Customer Panel", SwingConstants.CENTER);
        title.setFont(new Font("Arial", Font.BOLD, 20));
        title.setOpaque(true);
        title.setBackground(Color.BLUE);
        title.setForeground(Color.WHITE);
        title.setBounds(150, 10, 450, 30);
        internalFrame.add(title);

        JPanel leftPanel = new JPanel(null);
        leftPanel.setBackground(Color.BLUE);
        leftPanel.setBounds(30, 60, 300, 250);
        internalFrame.add(leftPanel);

        JPanel rightPanel = new JPanel(null);
        rightPanel.setBackground(Color.BLUE);
        rightPanel.setBounds(350, 60, 300, 250);
        internalFrame.add(rightPanel);

        // Fields
        JTextField cusID = new JTextField();
        JTextField firstName = new JTextField();
        JTextField lastName = new JTextField();
        JTextField passportNo = new JTextField();
        JTextField nationalID = new JTextField();
        JTextArea address = new JTextArea();
        JTextField contactField = new JTextField();
        JTextField dobField = new JTextField("DD-MM-YYYY");
        JRadioButton male = new JRadioButton("Male");
        JRadioButton female = new JRadioButton("Female");

        // Auto-ID Logic
        try {
            Connection con;
            PreparedStatement pre;
            Class.forName("com.mysql.cj.jdbc.Driver");
            con = DriverManager.getConnection("jdbc:mysql://localhost:3306/airline_project", "root", "ritu123");
            pre = con.prepareStatement("SELECT MAX(CustomerID) FROM Customer");
            ResultSet rs = pre.executeQuery();
            rs.next();
            String maxId = rs.getString("MAX(CustomerID)");
            if (maxId == null) {
                cusID.setText("CS001");
            } else {
                long id = Long.parseLong(maxId.substring(2));
                id++;
                cusID.setText("CS" + String.format("%03d", id));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        // Left panel form
        int y = 10;
        String[] labels = {"Customer ID", "First Name", "Last Name", "Passport No.", "National ID", "Address"};
        JComponent[] components = {cusID, firstName, lastName, passportNo, nationalID, new JScrollPane(address)};

        for (int i = 0; i < labels.length; i++) {
            JLabel lbl = new JLabel(labels[i]);
            lbl.setForeground(Color.WHITE);
            lbl.setBounds(10, y, 100, 25);
            leftPanel.add(lbl);

            JComponent comp = components[i];
            if (comp instanceof JScrollPane) {
                comp.setBounds(120, y, 150, 60);
                y += 35; // Extra space for textarea
            } else {
                comp.setBounds(120, y, 150, 25);
            }
            leftPanel.add(comp);
            y += 35;
        }

        // Right panel form
        JLabel contactLbl = new JLabel("Contact");
        contactLbl.setForeground(Color.WHITE);
        contactLbl.setBounds(10, 10, 100, 25);
        rightPanel.add(contactLbl);
        contactField.setBounds(120, 10, 150, 25);
        rightPanel.add(contactField);

        JLabel genderLbl = new JLabel("Gender");
        genderLbl.setForeground(Color.WHITE);
        genderLbl.setBounds(10, 50, 100, 25);
        rightPanel.add(genderLbl);
        male.setBounds(120, 50, 70, 25);
        female.setBounds(190, 50, 80, 25);
        male.setBackground(Color.BLUE);
        female.setBackground(Color.BLUE);
        male.setForeground(Color.WHITE);
        female.setForeground(Color.WHITE);
        ButtonGroup genderGroup = new ButtonGroup();
        genderGroup.add(male);
        genderGroup.add(female);
        rightPanel.add(male);
        rightPanel.add(female);

        JLabel dobLbl = new JLabel("Date of Birth");
        dobLbl.setForeground(Color.WHITE);
        dobLbl.setBounds(10, 90, 100, 25);
        rightPanel.add(dobLbl);
        dobField.setBounds(120, 90, 150, 25);
        rightPanel.add(dobField);

        // Buttons
        JButton addBtn = new JButton("Add");
        addBtn.setBounds(200, 330, 100, 30);
        internalFrame.add(addBtn);

        JButton deleteBtn = new JButton("Delete");
        deleteBtn.setBounds(320, 330, 100, 30);
        internalFrame.add(deleteBtn);

        // Add Button Action
        addBtn.addActionListener(e -> {
            String id = cusID.getText();
            String fname = firstName.getText();
            String lname = lastName.getText();
            String passport = passportNo.getText();
            String natID = nationalID.getText();
            String addr = address.getText();
            String contact = contactField.getText();
            String dob = dobField.getText();
            String gender = male.isSelected() ? "Male" : female.isSelected() ? "Female" : "";

            if (fname.isEmpty() || lname.isEmpty() || contact.isEmpty() || gender.isEmpty()) {
                JOptionPane.showMessageDialog(internalFrame, "Please fill all required fields.");
                return;
            }

            try {
                Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/airline_project", "root", "ritu123");
                PreparedStatement pre = con.prepareStatement("INSERT INTO Customer(CustomerID, FirstName, LastName, Passport, NationalID, Address, Contact, Gender, DOB) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)");
                pre.setString(1, id);
                pre.setString(2, fname);
                pre.setString(3, lname);
                pre.setString(4, passport);
                pre.setString(5, natID);
                pre.setString(6, addr);
                pre.setString(7, contact);
                pre.setString(8, gender);
                pre.setString(9, dob);
                pre.executeUpdate();

                JOptionPane.showMessageDialog(internalFrame, "Customer Added Successfully!");
                internalFrame.dispose(); // Close the frame after success
            } catch (SQLException ex) {
                ex.printStackTrace();
                JOptionPane.showMessageDialog(internalFrame, "Error: " + ex.getMessage());
            }
        });

        // Delete Button Action
        deleteBtn.addActionListener(e -> {
            firstName.setText("");
            lastName.setText("");
            passportNo.setText("");
            nationalID.setText("");
            address.setText("");
            contactField.setText("");
            dobField.setText("");
            genderGroup.clearSelection();
        });

        internalFrame.setVisible(true);
        return internalFrame;
    }
}
